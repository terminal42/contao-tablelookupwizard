var TableLookupWizard=function(){"use strict";return function(e,t){var n,r,o,a,d;function i(n){var a=n.target.getParent("tr");n.target.checked?(a.removeClass("found").addClass("selected").inject(r.getElement("tr.search"),"before"),t&&t.enableSorting&&(a.getElement(".drag-handle").setStyle("display","inline"),d.addItems(a)),window.fireEvent("tableLookupWizard_postModified",{name:e,operation:"selected",element:a})):(a.destroy(),r.send(o),t&&t.enableSorting&&d.removeItems(a),window.fireEvent("tableLookupWizard_postModified",{name:e,operation:"unselected",element:a}))}function l(e){e.target.getParent("tr").removeClass("found").inject(a,"before"),e.target.getParent("tr").getAllPrevious().destroy(),r.send(o)}r=document.id("ctrl_"+e),a=r.getElement("tr.reset, tr.search"),o=window.location.href+"&tableLookupWizard="+e,t&&t.enableSorting&&((d=new Sortables(r.getElements("tbody"),{constrain:!0,clone:!1,handle:".drag-handle"})).getDroppables=function(){return r.getElements("tbody tr.row.selected")},d.removeItems(r.getElements("tbody tr.search"),r.getElements("tbody tr.reset"))),r.getElements("tbody tr").forEach((function(t){var n=t.getElement("input[type=checkbox]")||t.getElement("input[type=radio]");n&&n.addEvent("change",(function(t){t.target.getParent("tr").hasClass("reset")?t.target.getParent("tr").getAllPrevious().destroy():(t.target.getParent("tr").destroy(),window.fireEvent("tableLookupWizard_postModified",{name:e,operation:"unselected",element:t.target.getParent("tr")})),r.send(o)}))})),r.set("send",{method:"get",link:"cancel",onSuccess:function(t){var n;try{t=JSON.decode(t).content}catch(e){}r.getElements(".search input.tl_text").removeClass("loading"),r.getElements("tr.found").destroy(),n=Elements.from(t,!1),r.getElement("tbody").adopt(n),n.forEach((function(e){e.getElement("input[type=checkbox]")&&e.getElement("input[type=checkbox]").addEvent("click",i),e.getElement("input[type=radio]")&&e.getElement("input[type=radio]").addEvent("click",l)})),window.fireEvent("tableLookupWizard_postSearch",{name:e,result:t})}}).addEvent("keyup",(function(){clearTimeout(n),n=setTimeout((function(){r.getElement(".search input.tl_text").addClass("loading"),r.send(o)}),300)}))}}();