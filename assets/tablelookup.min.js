var TableLookupWizard=function(){"use strict";return function(e,t){function n(e){var n=e.target.getParent("tr");e.target.checked?(n.removeClass("found").addClass("selected").inject(a.getElement("tr.search"),"before"),t&&t.enableSorting&&(n.getElement(".drag-handle").setStyle("display","inline"),i.addItems(n))):(n.destroy(),a.send(l),t&&t.enableSorting&&i.removeItems(n))}function r(e){e.target.getParent("tr").removeClass("found").inject(d,"before"),e.target.getParent("tr").getAllPrevious().destroy(),a.send(l)}function o(){i=new Sortables(a.getElements("tbody"),{constrain:!0,clone:!1,handle:".drag-handle"}),i.getDroppables=function(){return a.getElements("tbody tr.row.selected")},i.removeItems(a.getElements("tbody tr.search"),a.getElements("tbody tr.reset"))}var s,a,l,d,i;a=document.id("ctrl_"+e),d=a.getElement("tr.reset, tr.search"),l=window.location.href+"&tableLookupWizard="+e,t&&t.enableSorting&&o(),a.getElement(".jserror").setStyle("display","none"),a.getElement(".search").setStyle("display",Browser.ie&&Browser.version<8||Browser.Engine&&Browser.Engine.trident&&Browser.Engine.version<6?"block":"table-row"),a.getElements("tbody tr").forEach(function(e){var t=e.getElement("input[type=checkbox]")||e.getElement("input[type=radio]");t&&t.addEvent("change",function(e){e.target.getParent("tr").hasClass("reset")?e.target.getParent("tr").getAllPrevious().destroy():e.target.getParent("tr").destroy(),a.send(l)})}),a.set("send",{method:"get",link:"cancel",onSuccess:function(e){var t;try{e=JSON.decode(e).content}catch(o){}a.getElements(".search input.tl_text").setStyle("background-image","none"),a.getElements("tr.found").destroy(),t=Elements.from(e,!1),a.getElement("tbody").adopt(t),t.forEach(function(e){e.getElement("input[type=checkbox]")&&e.getElement("input[type=checkbox]").addEvent("click",n),e.getElement("input[type=radio]")&&e.getElement("input[type=radio]").addEvent("click",r)})}}).addEvent("keyup",function(){clearTimeout(s),s=setTimeout(function(){a.getElement(".search input.tl_text").setStyle("background-image","url(system/modules/tablelookupwizard/assets/loading.gif)"),a.send(l)},300)})}}();